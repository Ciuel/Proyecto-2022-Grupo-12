{% set current_template = self._TemplateReference__context.name %}
{% extends "base.html" %}
{% block css %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='fonts/fontawesome-all.min.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/Pretty-Search-Form-.css') }}" />
{% endblock css %}
{% block title %} Socios {% endblock title %}

<body>
  {% block content %}
  <div class="d-flex flex-column justify-content-center align-items-center">


    <section class="d-flex align-items-center align-self-center own_flex_column" id="searchHeader">
            {% if has_permission(session["user"],"associate_create") %}
      <a href="{{ url_for('associate.get_add') }}">
        <button class="btn own_golden_bg own_add_button" type="button">
          Agregar
        </button>
      </a>
      {%endif%}
      {% if has_permission(session["user"],"associate_index") %}
      {% include "search.html" %}
      {%endif%}
    </section>
     {% if has_permission(session["user"],"associate_index") %}
      <div class="mt-2 d-flex align-items-center gap-2">
          <span class="own_export_text"><b>Exportar:</b></span>
            <form method="GET" action="{{ url_for('associate.write_csv') }}">
              <input type="image" src="/public/img/Excel_icon.png" style="height: 50px; margin-right:10px;">
            </form>
            <form method="GET" action="{{ url_for('associate.write_pdf') }}">
              <input type="image" src="/public/img/PDF_icon.png" style="height: 50px;">
            </form>
      </div>
      {%endif%}
    {% include "flashes.html" %}
    <section class="container">
      <div class="own_main_body own_centered">
        <table class="table table-striped table-bordered own_main_table">
          <thead>
            <tr class="own_table_header">
              <th style="width: 20%">Nombre y apellido</th>
              <th style="width: 10%">DNI</th>
              <th style="width: 20%">Domicilio</th>
              <th style="width: 10%">Estado</th>
              <th style="width: 25%">Disciplinas</th>
              {% if has_permission(session["user"],"associate_update") %}
              <th style="width: 5%">Modificar</th>
              {%endif%}
              {% if has_permission(session["user"],"associate_add_discip") or has_permission(session["user"],"associate_remove_discip") %}
              <th style="width: 5%">Disciplinas</th>
              {%endif%}
              <th style="width: 5%">Pagar</th>
              {% if has_permission(session["user"],"associate_destroy") %}
              <th style="width: 5%">Eliminar</th>
              {%endif%}
            </tr>
          </thead>
          <tbody>
            {% for associate in associates.items %}
            <tr class="own_centered">
              <td> {{ associate.name }} {{ associate.surname }}</td>
              <td> {{ associate.DNI_number }} </td>
              <td> {{ associate.address }} </td>
              <td> {% if associate.active %} Activo {% else %} Inactivo {% endif %} </td>
              <td> {% if associate.disciplines %}
                {% for disciplina in associate.disciplines %}
                {{ disciplina.name }} {{ disciplina.category}},
                {% endfor %}
                {% else %}
                No posee
                {% endif %}
              </td>
              {% if has_permission(session["user"],"associate_update") %}
              <td class="own_options_section">
                <a href="{{ url_for('associate.get_update' ,id=associate.id) }}">
                  <button class="btn btn-outline-info w-100 p-1 own_options_button">
                    Mod.
                  </button>
                </a>
              </td>
              {%endif%}
              {% if has_permission(session["user"],"associate_add_discip") or has_permission(session["user"],"associate_remove_discip") %}
              <td class="own_options_section">
                <form action="{{ url_for('associate.add_discipline', id=associate.id) }}" method="get">
                  <button class="btn btn-outline-danger w-100 p-1 own_options_button">
                    Asignar
                  </button>
                </form>
              </td>
              {%endif%}
              {% if has_permission(session["user"],"associate_destroy") %}
              <td class="own_options_section">
                <form action="{{ url_for('payments.create', id=associate.id) }}" method="post">
                  <button class="btn btn-outline-danger w-100 p-1 own_options_button"
                    onclick="return confirm('Seguro que desea eliminar a {{ associate.name }} {{ associate.surname }} con DNI {{associate.DNI_number}} ?');">
                    Pagar
                  </button>
                </form>
              </td>
              <td class="own_options_section">
                <form action="{{ url_for('associate.delete', id=associate.id) }}" method="post">
                  <button class="btn btn-outline-danger w-100 p-1 own_options_button"
                    onclick="return confirm('Seguro que desea pagar la cuota a {{ associate.name }} {{ associate.surname }} con DNI {{associate.DNI_number}} ?');">
                    X
                  </button>
                </form>
              </td>
              {%endif%}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
    {% if has_permission(session["user"],"associate_index") %}
    {% include "paginator.html"%}
    {%endif%}
  </div>
  <div class="d-flex align-center">
    {% endblock content%}
    {% block js%}
    {{ super() }}
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
    {% endblock js%}
</body>
